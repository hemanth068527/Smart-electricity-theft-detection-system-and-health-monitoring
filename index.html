<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Smart Electricity Theft Monitoring System</title>

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600;700&family=Outfit:wght@300;400;500;600;700&display=swap" rel="stylesheet">

<style>
/* ===== YOUR ORIGINAL CSS (UNCHANGED) ===== */
:root {
  --bg-dark:#0a0e17;
  --bg-card:rgba(15,23,42,.6);
  --bg-card-border:rgba(0,255,136,.15);
  --neon-green:#00ff88;
  --neon-yellow:#ffd000;
  --neon-red:#ff3366;
  --text-primary:#f0f4f8;
  --text-secondary:#94a3b8;
}
body{font-family:'Outfit',sans-serif;background:var(--bg-dark);color:var(--text-primary)}
.container{max-width:1400px;margin:auto;padding:24px}
.stats-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:20px}
.stat-card{background:var(--bg-card);border:1px solid var(--bg-card-border);border-radius:16px;padding:20px}
.stat-value{font-family:'JetBrains Mono';font-size:1.7rem;font-weight:700;color:var(--neon-green)}
.stat-label{font-size:.8rem;color:var(--text-secondary);margin-bottom:6px}
.theft-banner{margin:32px 0;padding:24px;border-radius:16px;text-align:center;font-family:'JetBrains Mono'}
.theft-banner.normal{color:var(--neon-green);border:1px solid rgba(0,255,136,.3)}
.theft-banner.theft{color:var(--neon-red);border:1px solid rgba(255,51,102,.4)}
iframe{width:100%;height:260px;border:none}
</style>
</head>

<body>
<div class="container">

<header style="text-align:center">
  <h1>Smart Electricity Theft Monitoring System</h1>
  <p>Real-time transformer & house current monitoring using IoT</p>
</header>

<!-- ===== STATS ===== -->
<div class="stats-grid">

  <div class="stat-card">
    <div class="stat-label">Transformer Current</div>
    <div class="stat-value"><span id="transformer-current">--</span> A</div>
  </div>

  <div class="stat-card">
    <div class="stat-label">House 1 Current</div>
    <div class="stat-value"><span id="house1-current">--</span> A</div>
  </div>

  <div class="stat-card">
    <div class="stat-label">House 2 Current</div>
    <div class="stat-value"><span id="house2-current">--</span> A</div>
  </div>

  <!-- üîÅ CHANGED: HOUSE 3 ‚Üí UNMETERED CURRENT -->
  <div class="stat-card">
    <div class="stat-label">Unmetered (Undetected) Current</div>
    <div class="stat-value"><span id="unmetered-current">--</span> A</div>
  </div>

</div>

<!-- ===== STATUS ===== -->
<div class="theft-banner normal" id="theft-banner">
  <div id="theft-status">‚ö° NORMAL OPERATION</div>
  <div id="theft-time"></div>
</div>

<!-- ===== GRAPHS ===== -->
<div class="stats-grid">
  <iframe id="chart1"></iframe>
  <iframe id="chart2"></iframe>
  <iframe id="chart3"></iframe>
  <iframe id="chart4"></iframe>
</div>

</div>

<script>
const CHANNEL_ID = 3236533;
const API_KEY = "X9QA1LSCASFB7N60";

const chartBase = `https://api.thingspeak.com/channels/${CHANNEL_ID}/charts`;
const chartParams = `?api_key=${API_KEY}&bgcolor=%230a0e17&color=%2300ff88&dynamic=true&results=60`;

document.getElementById("chart1").src = `${chartBase}/1${chartParams}`;
document.getElementById("chart2").src = `${chartBase}/2${chartParams}`;
document.getElementById("chart3").src = `${chartBase}/3${chartParams}`;
document.getElementById("chart4").src = `${chartBase}/4${chartParams}`; // unmetered

function format(v){
  return isNaN(v) ? "--" : parseFloat(v).toFixed(2);
}

function fetchData(){
  fetch(`https://api.thingspeak.com/channels/${CHANNEL_ID}/feeds/last.json?api_key=${API_KEY}`)
    .then(r=>r.json())
    .then(data=>{

      document.getElementById("transformer-current").textContent = format(data.field1);
      document.getElementById("house1-current").textContent      = format(data.field2);
      document.getElementById("house2-current").textContent      = format(data.field3);

      // üîÅ CHANGED: field4 ‚Üí unmetered current
      document.getElementById("unmetered-current").textContent   = format(data.field4);

      const banner = document.getElementById("theft-banner");
      const status = document.getElementById("theft-status");
      const time   = document.getElementById("theft-time");

      if (parseInt(data.field5) === 1){
        banner.className = "theft-banner theft";
        status.textContent = "üö® ELECTRICITY THEFT DETECTED";
        time.textContent = "Detected at: " + new Date(data.created_at).toLocaleString();
      } else {
        banner.className = "theft-banner normal";
        status.textContent = "‚ö° NORMAL OPERATION";
        time.textContent = "";
      }
    });
}

fetchData();
setInterval(fetchData,15000);
</script>
</body>
</html>

